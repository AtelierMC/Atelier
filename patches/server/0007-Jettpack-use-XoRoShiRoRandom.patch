From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Simon Gardling <titaniumtown@gmail.com>
Date: Wed, 5 Jan 2022 12:25:37 -0500
Subject: [PATCH] Jettpack: use XoRoShiRoRandom

This patch was originally created under the GNU Lesser General Public License v3.0 for the "JettPack" project: https://gitlab.com/Titaniumtown/JettPack

diff --git a/src/main/java/com/destroystokyo/paper/loottable/PaperLootableInventoryData.java b/src/main/java/com/destroystokyo/paper/loottable/PaperLootableInventoryData.java
index 20cfe7b9b7127ddeb97aa91d759fc17b4a548eaf..be669ec0be96816ada803aff28710941325761e5 100644
--- a/src/main/java/com/destroystokyo/paper/loottable/PaperLootableInventoryData.java
+++ b/src/main/java/com/destroystokyo/paper/loottable/PaperLootableInventoryData.java
@@ -13,7 +13,7 @@ import java.util.UUID;
 
 public class PaperLootableInventoryData {
 
-    private static final Random RANDOM = new Random();
+    private static final Random RANDOM = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
 
     private long lastFill = -1;
     private long nextRefill = -1;
diff --git a/src/main/java/me/titaniumtown/util/rand/SplitMixRandom.java b/src/main/java/me/titaniumtown/util/rand/SplitMixRandom.java
new file mode 100644
index 0000000000000000000000000000000000000000..02c5d6365a94da0bfa34bc8fac845ca2a5f14635
--- /dev/null
+++ b/src/main/java/me/titaniumtown/util/rand/SplitMixRandom.java
@@ -0,0 +1,38 @@
+package me.titaniumtown.util.rand;
+
+import it.unimi.dsi.fastutil.HashCommon;
+
+// Note, this implementation was taken from sodium under the LGPLv3 License: https://github.com/CaffeineMC/sodium-fabric/blob/6390562feee9537461a7822b43d2f87691378e55/src/main/java/me/jellysquid/mods/sodium/client/util/rand/XoRoShiRoRandom.java
+
+// SplitMixRandom implementation from DSI Utilities, adopted in a minimal implementation to not
+// import Apache Commons.
+//
+// http://xoshiro.di.unimi.it/
+public class SplitMixRandom {
+    private static final long PHI = 0x9E3779B97F4A7C15L;
+
+    private long x;
+
+    public SplitMixRandom(final long seed) {
+        this.setSeed(seed);
+    }
+
+    private static long staffordMix13(long z) {
+        z = (z ^ (z >>> 30)) * 0xBF58476D1CE4E5B9L;
+        z = (z ^ (z >>> 27)) * 0x94D049BB133111EBL;
+
+        return z ^ (z >>> 31);
+    }
+
+    public long nextLong() {
+        return staffordMix13(this.x += PHI);
+    }
+
+    public void setSeed(final long seed) {
+        this.x = HashCommon.murmurHash3(seed);
+    }
+
+    public void setState(final long state) {
+        this.x = state;
+    }
+}
\ No newline at end of file
diff --git a/src/main/java/me/titaniumtown/util/rand/XoRoShiRoRandom.java b/src/main/java/me/titaniumtown/util/rand/XoRoShiRoRandom.java
new file mode 100644
index 0000000000000000000000000000000000000000..ee637622cc2ce1303f4a8254ee8e559b579c4c7b
--- /dev/null
+++ b/src/main/java/me/titaniumtown/util/rand/XoRoShiRoRandom.java
@@ -0,0 +1,153 @@
+package me.titaniumtown.util.rand;
+
+import java.util.Random;
+
+// Note, this implementation was taken from sodium under the LGPLv3 License: https://github.com/CaffeineMC/sodium-fabric/blob/6390562feee9537461a7822b43d2f87691378e55/src/main/java/me/jellysquid/mods/sodium/client/util/rand/XoRoShiRoRandom.java
+
+// XoRoShiRo128** implementation from DSI Utilities, adopted in a minimal implementation to not
+// import Apache Commons.
+//
+// http://xoshiro.di.unimi.it/
+public class XoRoShiRoRandom extends Random {
+    private static final long serialVersionUID = 1L;
+
+    private SplitMixRandom mixer;
+    private long seed = Long.MIN_VALUE;
+    private long p0, p1; // The initialization words for the current seed
+    private long s0, s1; // The current random words
+    private boolean hasSavedState; // True if we can be quickly reseed by using resetting the words
+
+    private static final SplitMixRandom seedUniquifier = new SplitMixRandom(System.nanoTime());
+
+    public static long randomSeed() {
+        final long x;
+
+        synchronized (XoRoShiRoRandom.seedUniquifier) {
+            x = XoRoShiRoRandom.seedUniquifier.nextLong();
+        }
+
+        return x ^ System.nanoTime();
+    }
+
+    public XoRoShiRoRandom() {
+        this(XoRoShiRoRandom.randomSeed());
+    }
+
+    public XoRoShiRoRandom(final long seed) {
+        this.setSeed(seed);
+    }
+
+    @Override
+    public long nextLong() {
+        final long s0 = this.s0;
+
+        long s1 = this.s1;
+
+        final long result = s0 + s1;
+
+        s1 ^= s0;
+
+        this.s0 = Long.rotateLeft(s0, 24) ^ s1 ^ s1 << 16;
+        this.s1 = Long.rotateLeft(s1, 37);
+
+        return result;
+    }
+
+    @Override
+    public int nextInt() {
+        return (int) this.nextLong();
+    }
+
+    @Override
+    public int nextInt(final int n) {
+        return (int) this.nextLong(n);
+    }
+
+    @Override
+    public long nextLong(final long n) {
+        if (n <= 0) {
+            throw new IllegalArgumentException("illegal bound " + n + " (must be positive)");
+        }
+
+        long t = this.nextLong();
+
+        final long nMinus1 = n - 1;
+
+        // Shortcut for powers of two--high bits
+        if ((n & nMinus1) == 0) {
+            return (t >>> Long.numberOfLeadingZeros(nMinus1)) & nMinus1;
+        }
+
+        // Rejection-based algorithm to get uniform integers in the general case
+        long u = t >>> 1;
+
+        while (u + nMinus1 - (t = u % n) < 0) {
+            u = this.nextLong() >>> 1;
+        }
+
+        return t;
+
+    }
+
+    @Override
+    public double nextDouble() {
+        return Double.longBitsToDouble(0x3FFL << 52 | this.nextLong() >>> 12) - 1.0;
+    }
+
+    @Override
+    public float nextFloat() {
+        return (this.nextLong() >>> 40) * 0x1.0p-24f;
+    }
+
+    @Override
+    public boolean nextBoolean() {
+        return this.nextLong() < 0;
+    }
+
+    @Override
+    public void nextBytes(final byte[] bytes) {
+        int i = bytes.length, n;
+
+        while (i != 0) {
+            n = Math.min(i, 8);
+
+            for (long bits = this.nextLong(); n-- != 0; bits >>= 8) {
+                bytes[--i] = (byte) bits;
+            }
+        }
+    }
+
+    @Override
+    public void setSeed(final long seed) {
+        // Restore the previous initial state if the seed hasn't changed
+        // Setting and mixing the seed is expensive, so this saves some CPU cycles
+        if (this.hasSavedState && this.seed == seed) {
+            this.s0 = this.p0;
+            this.s1 = this.p1;
+        } else {
+            SplitMixRandom mixer = this.mixer;
+
+            // Avoid allocations of SplitMixRandom
+            if (mixer == null) {
+                mixer = this.mixer = new SplitMixRandom(seed);
+            } else {
+                mixer.setSeed(seed);
+            }
+
+            this.s0 = mixer.nextLong();
+            this.s1 = mixer.nextLong();
+
+            this.p0 = this.s0;
+            this.p1 = this.s1;
+
+            this.seed = seed;
+            this.hasSavedState = true;
+        }
+    }
+
+    public XoRoShiRoRandom setSeedAndReturn(final long seed) {
+        this.setSeed(seed);
+
+        return this;
+    }
+}
\ No newline at end of file
diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java
index 35e84fa158ef01589e133e54fb6fa2e18d22d3c0..04165273a6c6e8dde12b9beb9b98b749e8ec66e2 100644
--- a/src/main/java/net/minecraft/server/MinecraftServer.java
+++ b/src/main/java/net/minecraft/server/MinecraftServer.java
@@ -348,7 +348,7 @@ public abstract class MinecraftServer extends ReentrantBlockableEventLoop<TickTa
         this.onMetricsRecordingFinished = (path) -> {
         };
         this.status = new ServerStatus();
-        this.random = new Random();
+        this.random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
         this.port = -1;
         this.levels = Maps.newLinkedHashMap(); // CraftBukkit - keep order, k+v already use identity methods
         this.running = true;
diff --git a/src/main/java/net/minecraft/server/commands/SpreadPlayersCommand.java b/src/main/java/net/minecraft/server/commands/SpreadPlayersCommand.java
index edc5b0fde13cecf1da371972bd040d7ca38a690b..df0d4d8db193d34fff996e47c2b84369d354559c 100644
--- a/src/main/java/net/minecraft/server/commands/SpreadPlayersCommand.java
+++ b/src/main/java/net/minecraft/server/commands/SpreadPlayersCommand.java
@@ -65,7 +65,7 @@ public class SpreadPlayersCommand {
         if (maxY < j) {
             throw SpreadPlayersCommand.ERROR_INVALID_MAX_HEIGHT.create(maxY, j);
         } else {
-            Random random = new Random();
+            Random random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
             double d0 = (double) (center.x - maxRange);
             double d1 = (double) (center.y - maxRange);
             double d2 = (double) (center.x + maxRange);
diff --git a/src/main/java/net/minecraft/server/level/ServerPlayer.java b/src/main/java/net/minecraft/server/level/ServerPlayer.java
index e217120cdfb35a631b488b784caeba14afd411c4..129517037d17e069d885ce6276ceee2db62ffc48 100644
--- a/src/main/java/net/minecraft/server/level/ServerPlayer.java
+++ b/src/main/java/net/minecraft/server/level/ServerPlayer.java
@@ -371,7 +371,7 @@ public class ServerPlayer extends Player {
             long l = k * k;
             int i1 = l > 2147483647L ? Integer.MAX_VALUE : (int) l;
             int j1 = this.getCoprime(i1);
-            int k1 = (new Random()).nextInt(i1);
+            int k1 = (new me.titaniumtown.util.rand.XoRoShiRoRandom()).nextInt(i1); // JettPack - use XoRoShiRoRandom
 
             for (int l1 = 0; l1 < i1; ++l1) {
                 int i2 = (k1 + j1 * l1) % i1;
@@ -408,7 +408,7 @@ public class ServerPlayer extends Player {
             long l = k * k;
             int i1 = l > 2147483647L ? Integer.MAX_VALUE : (int) l;
             int j1 = this.getCoprime(i1);
-            int k1 = (new Random()).nextInt(i1);
+            int k1 = (new me.titaniumtown.util.rand.XoRoShiRoRandom()).nextInt(i1); // JettPack - use XoRoShiRoRandom
 
             for (int l1 = 0; l1 < i1; ++l1) {
                 int i2 = (k1 + j1 * l1) % i1;
diff --git a/src/main/java/net/minecraft/server/network/ServerLoginPacketListenerImpl.java b/src/main/java/net/minecraft/server/network/ServerLoginPacketListenerImpl.java
index 9328309feee788797aeecaf9928dcbb8e8d7158a..21321d67d453b1bdda53b3fd86e84eca7b137304 100644
--- a/src/main/java/net/minecraft/server/network/ServerLoginPacketListenerImpl.java
+++ b/src/main/java/net/minecraft/server/network/ServerLoginPacketListenerImpl.java
@@ -48,7 +48,7 @@ public class ServerLoginPacketListenerImpl implements ServerLoginPacketListener
     private static final AtomicInteger UNIQUE_THREAD_ID = new AtomicInteger(0);
     static final Logger LOGGER = LogUtils.getLogger();
     private static final int MAX_TICKS_BEFORE_LOGIN = 600;
-    private static final Random RANDOM = new Random();
+    private static final Random RANDOM = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
     private final byte[] nonce = new byte[4];
     final MinecraftServer server;
     public final Connection connection;
diff --git a/src/main/java/net/minecraft/server/rcon/thread/QueryThreadGs4.java b/src/main/java/net/minecraft/server/rcon/thread/QueryThreadGs4.java
index 000918fe0cc3fde07145e027b25f148afcb0de62..fbf97bee76ee675149b3bf0c385110d0acf2b6c8 100644
--- a/src/main/java/net/minecraft/server/rcon/thread/QueryThreadGs4.java
+++ b/src/main/java/net/minecraft/server/rcon/thread/QueryThreadGs4.java
@@ -348,7 +348,7 @@ public class QueryThreadGs4 extends GenericThread {
             this.identBytes[2] = bs[5];
             this.identBytes[3] = bs[6];
             this.ident = new String(this.identBytes, StandardCharsets.UTF_8);
-            this.challenge = (new Random()).nextInt(16777216);
+            this.challenge = (new me.titaniumtown.util.rand.XoRoShiRoRandom()).nextInt(16777216); // JettPack - use XoRoShiRoRandom
             this.challengeBytes = String.format("\t%s%d\u0000", this.ident, this.challenge).getBytes(StandardCharsets.UTF_8);
         }
 
diff --git a/src/main/java/net/minecraft/world/entity/ai/behavior/ShufflingList.java b/src/main/java/net/minecraft/world/entity/ai/behavior/ShufflingList.java
index 204ca4fbd89bdadd902529f1f191df46fce3cace..6a9f2473b73634c656f9a28d633090aeba6e8936 100644
--- a/src/main/java/net/minecraft/world/entity/ai/behavior/ShufflingList.java
+++ b/src/main/java/net/minecraft/world/entity/ai/behavior/ShufflingList.java
@@ -13,7 +13,7 @@ import java.util.stream.Stream;
 
 public class ShufflingList<U> {
     public final List<ShufflingList.WeightedEntry<U>> entries; // Paper - public
-    private final Random random = new Random();
+    private final Random random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
     private final boolean isUnsafe; // Paper
 
     public ShufflingList() {
diff --git a/src/main/java/net/minecraft/world/entity/ai/sensing/Sensor.java b/src/main/java/net/minecraft/world/entity/ai/sensing/Sensor.java
index f3b8e253a5bfc3f68121dbe656ae7e2ac0f0eb1c..28ca514b6d51ca07dc92e3a2fa7bf02618bfed05 100644
--- a/src/main/java/net/minecraft/world/entity/ai/sensing/Sensor.java
+++ b/src/main/java/net/minecraft/world/entity/ai/sensing/Sensor.java
@@ -8,7 +8,7 @@ import net.minecraft.world.entity.ai.memory.MemoryModuleType;
 import net.minecraft.world.entity.ai.targeting.TargetingConditions;
 
 public abstract class Sensor<E extends LivingEntity> {
-    private static final Random RANDOM = new Random();
+    private static final Random RANDOM = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
     private static final int DEFAULT_SCAN_RATE = 20;
     protected static final int TARGETING_RANGE = 16;
     private static final TargetingConditions TARGET_CONDITIONS = TargetingConditions.forNonCombat().range(16.0D);
diff --git a/src/main/java/net/minecraft/world/entity/npc/WanderingTraderSpawner.java b/src/main/java/net/minecraft/world/entity/npc/WanderingTraderSpawner.java
index 17fc1e07069546cdd3a7bd35e900e4c35ed43fd5..9babc3d342f4b3264636aae1ebeabb8deb9b78fa 100644
--- a/src/main/java/net/minecraft/world/entity/npc/WanderingTraderSpawner.java
+++ b/src/main/java/net/minecraft/world/entity/npc/WanderingTraderSpawner.java
@@ -36,7 +36,7 @@ public class WanderingTraderSpawner implements CustomSpawner {
     private static final int SPAWN_CHANCE_INCREASE = 25;
     private static final int SPAWN_ONE_IN_X_CHANCE = 10;
     private static final int NUMBER_OF_SPAWN_ATTEMPTS = 10;
-    private final Random random = new Random();
+    private final Random random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
     private final ServerLevelData serverLevelData;
     private int tickDelay;
     private int spawnDelay;
diff --git a/src/main/java/net/minecraft/world/entity/projectile/FishingHook.java b/src/main/java/net/minecraft/world/entity/projectile/FishingHook.java
index 67e11fd3b012d74652baf5875b6bd77e6e997d9d..eee64a32e046b8514b047d7bcf2a1814fa455de7 100644
--- a/src/main/java/net/minecraft/world/entity/projectile/FishingHook.java
+++ b/src/main/java/net/minecraft/world/entity/projectile/FishingHook.java
@@ -79,7 +79,7 @@ public class FishingHook extends Projectile {
 
     private FishingHook(EntityType<? extends FishingHook> type, Level world, int luckOfTheSeaLevel, int lureLevel) {
         super(type, world);
-        this.syncronizedRandom = new Random();
+        this.syncronizedRandom = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
         this.openWater = true;
         this.currentState = FishingHook.FishHookState.FLYING;
         this.noCulling = true;
diff --git a/src/main/java/net/minecraft/world/entity/raid/Raid.java b/src/main/java/net/minecraft/world/entity/raid/Raid.java
index f50abfd058e3adf1cf8c0f4468a60bc04e8541e7..6787f416afb330d3a8b649cf694ce7f4ffd6a3b6 100644
--- a/src/main/java/net/minecraft/world/entity/raid/Raid.java
+++ b/src/main/java/net/minecraft/world/entity/raid/Raid.java
@@ -110,7 +110,7 @@ public class Raid {
 
     public Raid(int id, ServerLevel world, BlockPos pos) {
         this.raidEvent = new ServerBossEvent(Raid.RAID_NAME_COMPONENT, BossEvent.BossBarColor.RED, BossEvent.BossBarOverlay.NOTCHED_10);
-        this.random = new Random();
+        this.random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
         this.waveSpawnPos = Optional.empty();
         this.id = id;
         this.level = world;
@@ -124,7 +124,7 @@ public class Raid {
 
     public Raid(ServerLevel world, CompoundTag nbt) {
         this.raidEvent = new ServerBossEvent(Raid.RAID_NAME_COMPONENT, BossEvent.BossBarColor.RED, BossEvent.BossBarOverlay.NOTCHED_10);
-        this.random = new Random();
+        this.random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
         this.waveSpawnPos = Optional.empty();
         this.level = world;
         this.id = nbt.getInt("Id");
diff --git a/src/main/java/net/minecraft/world/inventory/EnchantmentMenu.java b/src/main/java/net/minecraft/world/inventory/EnchantmentMenu.java
index ea7b670aa6308bbe9919afced02a9067da20f0ce..f82b0b114a71416378b41b97d3b9310f71ce69c3 100644
--- a/src/main/java/net/minecraft/world/inventory/EnchantmentMenu.java
+++ b/src/main/java/net/minecraft/world/inventory/EnchantmentMenu.java
@@ -72,7 +72,7 @@ public class EnchantmentMenu extends AbstractContainerMenu {
             }
             // CraftBukkit end
         };
-        this.random = new Random();
+        this.random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
         this.enchantmentSeed = DataSlot.standalone();
         this.costs = new int[3];
         this.enchantClue = new int[]{-1, -1, -1};
diff --git a/src/main/java/net/minecraft/world/level/BaseSpawner.java b/src/main/java/net/minecraft/world/level/BaseSpawner.java
index 6bbf1618e41c81fd2064ffd5d835187a927f24b7..2ab1a54b2e39a5a169337a34a2e750810ba4ee4f 100644
--- a/src/main/java/net/minecraft/world/level/BaseSpawner.java
+++ b/src/main/java/net/minecraft/world/level/BaseSpawner.java
@@ -41,7 +41,7 @@ public abstract class BaseSpawner {
     public int maxNearbyEntities = 6;
     public int requiredPlayerRange = 16;
     public int spawnRange = 4;
-    private final Random random = new Random();
+    private final Random random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
     private int tickDelay = 0; // Paper
 
     public BaseSpawner() {}
diff --git a/src/main/java/net/minecraft/world/level/Explosion.java b/src/main/java/net/minecraft/world/level/Explosion.java
index 29f6c10e2c2626a9726d295acf12efea2b463cd3..6a3b794253fe62d7fe1c472876d20c09322a1f77 100644
--- a/src/main/java/net/minecraft/world/level/Explosion.java
+++ b/src/main/java/net/minecraft/world/level/Explosion.java
@@ -89,7 +89,7 @@ public class Explosion {
     }
 
     public Explosion(Level world, @Nullable Entity entity, @Nullable DamageSource damageSource, @Nullable ExplosionDamageCalculator behavior, double x, double y, double z, float power, boolean createFire, Explosion.BlockInteraction destructionType) {
-        this.random = new Random();
+        this.random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
         this.toBlow = Lists.newArrayList();
         this.hitPlayers = Maps.newHashMap();
         this.level = world;
diff --git a/src/main/java/net/minecraft/world/level/Level.java b/src/main/java/net/minecraft/world/level/Level.java
index 94f908bfb73b2ff9bb97e5bc93685a83051d9676..436e5716b4af1468de08fe15a0249b1328714dab 100644
--- a/src/main/java/net/minecraft/world/level/Level.java
+++ b/src/main/java/net/minecraft/world/level/Level.java
@@ -121,13 +121,13 @@ public abstract class Level implements LevelAccessor, AutoCloseable {
     public final Thread thread;
     private final boolean isDebug;
     private int skyDarken;
-    protected int randValue = (new Random()).nextInt();
+    protected int randValue = (new me.titaniumtown.util.rand.XoRoShiRoRandom()).nextInt(); // JettPack - use XoRoShiRoRandom
     protected final int addend = 1013904223;
     protected float oRainLevel;
     public float rainLevel;
     protected float oThunderLevel;
     public float thunderLevel;
-    public final Random random = new Random();
+    public final Random random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
     final DimensionType dimensionType;
     private final Holder<DimensionType> dimensionTypeRegistration;
     public final WritableLevelData levelData;
diff --git a/src/main/java/net/minecraft/world/level/block/entity/DispenserBlockEntity.java b/src/main/java/net/minecraft/world/level/block/entity/DispenserBlockEntity.java
index f74c5bb8e1ba42c77c59d481b871fd992483b128..c8984839e21067a5582a5457ffb7633ff0ba7bbe 100644
--- a/src/main/java/net/minecraft/world/level/block/entity/DispenserBlockEntity.java
+++ b/src/main/java/net/minecraft/world/level/block/entity/DispenserBlockEntity.java
@@ -21,7 +21,7 @@ import org.bukkit.entity.HumanEntity;
 
 public class DispenserBlockEntity extends RandomizableContainerBlockEntity {
 
-    private static final Random RANDOM = new Random();
+    private static final Random RANDOM = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
     public static final int CONTAINER_SIZE = 9;
     private NonNullList<ItemStack> items;
 
diff --git a/src/main/java/net/minecraft/world/level/storage/loot/LootContext.java b/src/main/java/net/minecraft/world/level/storage/loot/LootContext.java
index d33af84300db18ea2b71dba2c9ed43390a293500..f80d375eec908713622d3e3b447ca906129d19f5 100644
--- a/src/main/java/net/minecraft/world/level/storage/loot/LootContext.java
+++ b/src/main/java/net/minecraft/world/level/storage/loot/LootContext.java
@@ -201,7 +201,7 @@ public class LootContext {
                 } else {
                     Random random = this.random;
                     if (random == null) {
-                        random = new Random();
+                        random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
                     }
 
                     MinecraftServer minecraftServer = this.level.getServer();
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftWorld.java b/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
index a3ddeb9862bc87294c215dc906cd8cca8f699b62..5734583ed14192128a464750d8cf80e24aadf401 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
@@ -239,7 +239,7 @@ public class CraftWorld extends CraftRegionAccessor implements World {
     }
     // Paper end
 
-    private static final Random rand = new Random();
+    private static final Random rand = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
 
     public CraftWorld(ServerLevel world, ChunkGenerator gen, BiomeProvider biomeProvider, Environment env) {
         this.world = world;
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftFirework.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftFirework.java
index be86114eac3975b82ca74d4d6ed3f0402a642e8a..4d3130dd6d8ca30c7bb98870ef30594e1c412858 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftFirework.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftFirework.java
@@ -13,7 +13,7 @@ import org.bukkit.inventory.meta.FireworkMeta;
 
 public class CraftFirework extends CraftProjectile implements Firework {
 
-    private final Random random = new Random();
+    private final Random random = new me.titaniumtown.util.rand.XoRoShiRoRandom(); // JettPack - use XoRoShiRoRandom
     private final CraftItemStack item;
 
     public CraftFirework(CraftServer server, FireworkRocketEntity entity) {
